# CymConductor - Docker Compose Configuration
version: '3.8'

services:
  orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: cymconductor
    ports:
      - "8081:8081"
    environment:
      - SERVER_PORT=8081
      - DATABASE_PATH=/data/orchestrator.db
      - LOG_LEVEL=info
      - WEB_DIR=/srv/web
      # Messenger Webhook Integration (Phase 4)
      - MESSENGER_ENABLED=true
      - MESSENGER_WEBHOOK_URL=http://host.docker.internal:8085/api/webhooks/orchestrator
      # Tickets Webhook Integration
      - TICKETS_WEBHOOK_URL=http://host.docker.internal:8086/api/webhooks/orchestrator
    volumes:
      - cymconductor-data:/data
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8081/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

  tickets:
    build:
      context: ../cymbytes-tickets
      dockerfile: Dockerfile
    container_name: cymbytes-tickets
    ports:
      - "8086:8086"
    environment:
      - HOST=0.0.0.0
      - PORT=8086
      - DATABASE_PATH=/data/tickets.db
      - LOG_LEVEL=info
      - WEBHOOKS_ENABLED=true
      - MESSENGER_WEBHOOK_URL=http://host.docker.internal:8085/api/webhooks/tickets
    volumes:
      - tickets-data:/data
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8086/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

volumes:
  cymconductor-data:
    driver: local
  tickets-data:
    driver: local
